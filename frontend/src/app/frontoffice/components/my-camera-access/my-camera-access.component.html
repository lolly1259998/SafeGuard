
<app-navbar></app-navbar>

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SafeGuard - Gestion des accès caméra</title>

  <!-- Bootstrap et Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <!-- Styles unifiés -->
  <style>
    .frontoffice-container { max-width: 1200px; margin: 2rem auto; padding: 0 1.5rem; }
    .main-card { background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow: hidden; }

    .page-header {
      background: linear-gradient(135deg, #3a0ca3, #4361ee);
      color: white;
      padding: 2.5rem;
    }
    .page-header h2 { font-weight: 700; font-size: 2.2rem; display:flex; align-items:center; gap:1rem; }
    .page-header p { margin:0; opacity:.9; }

    .card-content { padding: 2rem; }

    .access-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem; }

    .access-card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      border-left: 4px solid #4361ee;
      transition: .3s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
    }
    .access-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,.12); }
    .access-card.inactive { opacity: .65; border-left-color: #cbd5e1; }

    .access-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; border-bottom:1px solid #e2e8f0; padding-bottom:.7rem; }
    .status-badge { padding:.35rem .8rem; border-radius:20px; background:#e2e8f0; font-weight:600; font-size:.85rem; }
    .status-badge.active { background:rgba(67,97,238,.15); color:#4361ee; }

    .access-details { display:flex; flex-direction:column; gap:.8rem; }
    .detail-item { display:flex; justify-content:space-between; }

    .permission-tag { padding:.35rem .9rem; border-radius:20px; font-weight:600; font-size:.8rem; }
    .permission-admin { background:rgba(247,37,133,.1); color:#f72585; }
    .permission-manager { background:rgba(67,97,238,.1); color:#4361ee; }
    .permission-viewer { background:rgba(248,150,30,.1); color:#f8961e; }

    .expired { color:#f72585; font-weight:600; }

    .loading, .error-message, .no-data { border-radius:12px; text-align:center; padding:2rem; }
    .loading { border: 2px dashed #e2e8f0; color: #64748b; }
    .error-message { background: rgba(247,37,133,0.05); border: 1px solid rgba(247,37,133,0.2); color:#f72585; font-weight:500; }
    .no-data { background: rgba(67,97,238,0.05); border:1px solid rgba(67,97,238,0.2); color:#4361ee; font-weight:500; }
    .no-data p { margin:0; }

    /* Responsive */
    @media (max-width: 768px) {
      .access-grid { grid-template-columns: 1fr; }
      .access-header { flex-direction: column; align-items:flex-start; gap:.5rem; }
      .detail-item { flex-direction: column; align-items:flex-start; gap:.3rem; }
    }
  </style>
</head>
<body>

  <div class="frontoffice-container">
    <div class="main-card">

      <!-- HEADER -->
      <div class="page-header">
        <h2>
          <i class="fa-solid fa-video"></i>
          My Camera Access
        </h2>
        <p>List of your camera permissions</p>
      </div>

      <!-- CONTENT -->
      <div class="card-content">

        <!-- Loading -->
        <div *ngIf="isLoading" class="loading">
          <div class="spinner-border text-primary" role="status"></div>
          <p class="mt-3">Chargement de vos accès...</p>
        </div>

        <!-- Error -->
        <div *ngIf="error" class="error-message">
          <i class="fas fa-exclamation-triangle me-2"></i> {{ error }}
        </div>

        <!-- Access List -->
        <div *ngIf="!isLoading && !error && cameraAccesses.length > 0" class="access-grid">

          <div *ngFor="let access of cameraAccesses"
               class="access-card"
               [class.inactive]="!isAccessActive(access)">

            <div class="access-header">
              <h3>
                <i class="fa-solid fa-video"></i>
                {{ access.camera_name || 'Caméra ' + access.camera }}
              </h3>
              <span class="status-badge" [class.active]="isAccessActive(access)">
                {{ isAccessActive(access) ? 'Actif' : 'Inactif' }}
              </span>
            </div>

            <div class="access-details">
              <div class="detail-item">
                <strong>Permission:</strong>
                <span class="permission-tag"
                  [ngClass]="{
                    'permission-admin': access.permission === 'full',
                    'permission-manager': access.permission === 'limited',
                    'permission-viewer': access.permission === 'view'
                  }">
                  {{ getPermissionLabel(access.permission) }}
                </span>
              </div>

              <div class="detail-item">
                <strong>Granted on:</strong>
                <span>{{ access.granted_at | date:'dd/MM/yyyy' }}</span>
              </div>

              <div *ngIf="access.expires_at" class="detail-item">
                <strong>Expires:</strong>
                <span [class.expired]="!isAccessActive(access)">
                  {{ access.expires_at | date:'dd/MM/yyyy' }}
                </span>
              </div>
            </div>

          </div>
        </div>

        <!-- No Data -->
        <div *ngIf="!isLoading && !error && cameraAccesses.length === 0" class="no-data">
          <p><i class="fas fa-inbox me-2"></i> Aucun accès caméra trouvé</p>
        </div>

      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
