<div class="ai-performance-dashboard">
  <!-- En-tÃªte avec sÃ©lecteur dynamique -->
  <div class="dashboard-header mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <h4>Tableau de Bord IA - Control Centers</h4>
      <div class="d-flex gap-3 align-items-center">
        <div class="form-group mb-0">
          <select
            class="form-select"
            (change)="onControlCenterChange($event)"
            [disabled]="isloadingCenters || isLoading"
          >
            <option value="">SÃ©lectionner un centre</option>
            <option
              *ngFor="let center of controlCenters"
              [value]="center.id"
              [selected]="center.id === selectedControlCenter?.id"
            >
              {{ center.name }} ({{ center.location }}) - {{ center.status }}
            </option>
          </select>
        </div>

        <button
          class="btn btn-sm btn-outline-primary"
          (click)="loadPerformanceAnalysis()"
          [disabled]="isLoading || !selectedControlCenter"
        >
          ðŸ”„ Actualiser
        </button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isloadingCenters" class="text-center my-4">
    <div class="spinner-border text-primary"></div>
    <p>Chargement des centres de contrÃ´le...</p>
  </div>

  <!-- Aucun centre -->
  <div
    *ngIf="!isloadingCenters && controlCenters.length === 0"
    class="alert alert-warning text-center"
  >
    Aucun centre de contrÃ´le disponible.
  </div>

  <!-- Aucun centre sÃ©lectionnÃ© -->
  <div
    *ngIf="
      !isloadingCenters && controlCenters.length > 0 && !selectedControlCenter
    "
    class="alert alert-info text-center"
  >
    SÃ©lectionnez un centre pour afficher son analyse IA.
  </div>

  <!-- Affichage des donnÃ©es -->
  <div *ngIf="performanceData" class="card mt-4 p-4 shadow-sm">
    <h5>Analyse du centre : {{ selectedControlCenter.name }}</h5>
    <hr />

    <p>
      <strong>Performance Score :</strong>
      <span
        class="badge"
        [ngClass]="
          'bg-' + getPerformanceColor(performanceData.performance_score)
        "
      >
        {{ performanceData.performance_score }}%
      </span>
    </p>

    <p>
      <strong>Niveau de Risque :</strong>
      <span
        class="badge"
        [ngClass]="'bg-' + getRiskLevelColor(performanceData.risk_level)"
      >
        {{ performanceData.risk_level }}
      </span>
    </p>

    <div class="mt-3">
      <h6>DÃ©tails :</h6>
      <ul>
        <li>
          <strong>DisponibilitÃ© :</strong>
          {{ performanceData.performance_data?.uptime_analysis?.score }}%
        </li>
        <li>
          <strong>Optimisation :</strong>
          {{ performanceData.performance_data?.resource_optimization?.score }}%
        </li>
        <li>
          <strong>SÃ©curitÃ© :</strong>
          {{ performanceData.performance_data?.security_level?.score }}%
        </li>
      </ul>
    </div>

    <div class="mt-3">
      <h6>Recommandations :</h6>
      <ul>
        <li *ngFor="let rec of performanceData.recommendations">
          {{ rec.title }} â€” {{ rec.description }}
        </li>
      </ul>
    </div>
  </div>

  <!-- Loading IA -->
  <div *ngIf="isLoading" class="text-center my-4">
    <div class="spinner-border text-primary"></div>
    <p>Analyse IA en cours...</p>
  </div>
</div>
