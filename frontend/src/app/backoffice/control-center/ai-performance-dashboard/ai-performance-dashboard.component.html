<div class="ai-performance-dashboard container-fluid">
  <!-- En-tête -->
  <div
    class="dashboard-header mb-4 d-flex justify-content-between align-items-center"
  >
    <h3 class="dashboard-title">
      <i class="bi bi-cpu me-2 text-primary"></i> Tableau de Bord IA - Control
      Centers
    </h3>

    <div class="d-flex gap-3 align-items-center">
      <select
        class="form-select shadow-sm"
        (change)="onControlCenterChange($event)"
        [disabled]="isloadingCenters || isLoading"
      >
        <option value="">Sélectionner un centre</option>
        <option
          *ngFor="let center of controlCenters"
          [value]="center.id"
          [selected]="center.id === selectedControlCenter?.id"
        >
          {{ center.name }} ({{ center.location }}) - {{ center.status }}
        </option>
      </select>

      <button
        class="btn btn-primary d-flex align-items-center gap-2 shadow-sm"
        (click)="loadPerformanceAnalysis()"
        [disabled]="isLoading || !selectedControlCenter"
      >
        <i class="bi bi-arrow-repeat"></i> Actualiser
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isloadingCenters" class="text-center my-4">
    <div class="spinner-border text-primary"></div>
    <p class="mt-2 text-muted">Chargement des centres de contrôle...</p>
  </div>

  <!-- Aucun centre -->
  <div
    *ngIf="!isloadingCenters && controlCenters.length === 0"
    class="alert alert-warning text-center shadow-sm"
  >
    Aucun centre de contrôle disponible.
  </div>

  <!-- Aucun centre sélectionné -->
  <div
    *ngIf="
      !isloadingCenters && controlCenters.length > 0 && !selectedControlCenter
    "
    class="alert alert-info text-center shadow-sm"
  >
    Sélectionnez un centre pour afficher son analyse IA.
  </div>

  <!-- Données de performance -->
  <div *ngIf="performanceData" class="performance-card card shadow-lg p-4 mt-4">
    <h5 class="text-primary mb-3">
      <i class="bi bi-activity me-2"></i> Analyse du centre :
      <span class="fw-semibold">{{ selectedControlCenter.name }}</span>
    </h5>
    <hr />

    <div class="row">
      <div class="col-md-6 mb-3">
        <div class="info-box">
          <h6>Performance Score</h6>
          <span
            class="badge fs-6"
            [ngClass]="
              'bg-' + getPerformanceColor(performanceData.performance_score)
            "
          >
            {{ performanceData.performance_score }}%
          </span>
        </div>
      </div>

      <div class="col-md-6 mb-3">
        <div class="info-box">
          <h6>Niveau de Risque</h6>
          <span
            class="badge fs-6"
            [ngClass]="'bg-' + getRiskLevelColor(performanceData.risk_level)"
          >
            {{ performanceData.risk_level }}
          </span>
        </div>
      </div>
    </div>

    <div class="mt-3">
      <h6 class="text-secondary mb-2">Détails :</h6>
      <ul class="list-group small">
        <li class="list-group-item d-flex justify-content-between">
          <span>Disponibilité :</span>
          <span class="fw-semibold"
            >{{
              performanceData.performance_data?.uptime_analysis?.score
            }}%</span
          >
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>Optimisation :</span>
          <span class="fw-semibold"
            >{{
              performanceData.performance_data?.resource_optimization?.score
            }}%</span
          >
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>Sécurité :</span>
          <span class="fw-semibold"
            >{{
              performanceData.performance_data?.security_level?.score
            }}%</span
          >
        </li>
      </ul>
    </div>

    <div class="mt-4">
      <h6 class="text-secondary mb-2">Recommandations :</h6>
      <ul class="list-group list-group-flush">
        <li
          *ngFor="let rec of performanceData.recommendations"
          class="list-group-item"
        >
          <i class="bi bi-check2-circle text-success me-2"></i>
          <strong>{{ rec.title }}</strong> — {{ rec.description }}
        </li>
      </ul>
    </div>
  </div>

  <!-- Loading IA -->
  <div *ngIf="isLoading" class="text-center my-4">
    <div class="spinner-border text-primary"></div>
    <p class="mt-2 text-muted">Analyse IA en cours...</p>
  </div>
</div>
