<div class="container my-4">
  <!-- Header Section -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="text-primary fw-bold mb-2">Security Scenarios Management</h2>
      <p class="text-muted">Manage and monitor your security scenarios</p>
    </div>
    <div class="d-flex gap-2">
      <a routerLink="ai-dashboard" class="btn btn-info btn-lg d-flex align-items-center">
        <i class="bi bi-robot me-2"></i>AI Dashboard
      </a>
      <button class="btn btn-success btn-lg d-flex align-items-center" (click)="showAddForm = !showAddForm">
        <i class="bi" [ngClass]="editing ? 'bi-arrow-clockwise' : 'bi-plus-circle'"></i>
        <span class="ms-2">{{ editing ? "Update" : "Add Scenario" }}</span>
      </button>
    </div>
  </div>

  <!-- Add / Edit Form -->
  <div *ngIf="showAddForm" class="mb-4 p-4 border rounded bg-light shadow-sm">
    <h4 class="mb-3 text-primary">{{ editing ? 'Edit Scenario' : 'Create New Scenario' }}</h4>
    <form (ngSubmit)="addOrUpdateScenario()" #scenarioForm="ngForm">
      <div class="row mb-3">
        <div class="col-md-6">
          <label class="form-label fw-semibold">Scenario Name</label>
          <input
            type="text"
            class="form-control"
            placeholder="Enter scenario name"
            [(ngModel)]="editForm.name"
            name="name"
            required
          />
        </div>
        <div class="col-md-6">
          <label class="form-label fw-semibold">Priority Level</label>
          <select class="form-control" [(ngModel)]="editForm.priority" name="priority" required>
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
            <option value="critical">Critical</option>
          </select>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col-md-6">
          <label class="form-label fw-semibold">Event Types</label>
          <select multiple class="form-control" [(ngModel)]="editForm.event_types" name="event_types" size="3">
            <option value="motion">Motion Detection</option>
            <option value="unknown_face">Unknown Face</option>
            <option value="suspicious_object">Suspicious Object</option>
            <option value="intrusion">Intrusion</option>
          </select>
          <small class="text-muted">Hold Ctrl to select multiple options</small>
        </div>
        <div class="col-md-6">
          <label class="form-label fw-semibold">Start Time</label>
          <input type="time" class="form-control" [(ngModel)]="editForm.start_time" name="start_time">
        </div>
      </div>

      <div class="row mb-3">
        <div class="col-md-6">
          <label class="form-label fw-semibold">End Time</label>
          <input type="time" class="form-control" [(ngModel)]="editForm.end_time" name="end_time">
        </div>
        <div class="col-md-6">
          <label class="form-label fw-semibold">Active Days</label>
          <select multiple class="form-control" [(ngModel)]="editForm.days_of_week" name="days_of_week" size="3">
            <option value="0">Sunday</option>
            <option value="1">Monday</option>
            <option value="2">Tuesday</option>
            <option value="3">Wednesday</option>
            <option value="4">Thursday</option>
            <option value="5">Friday</option>
            <option value="6">Saturday</option>
          </select>
          <small class="text-muted">Hold Ctrl to select multiple days</small>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col-md-6">
          <div class="form-check form-switch">
            <input type="checkbox" class="form-check-input" [(ngModel)]="editForm.alert_email" name="alert_email" id="alertEmail">
            <label class="form-check-label fw-semibold" for="alertEmail">Email Alerts</label>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-check form-switch">
            <input type="checkbox" class="form-check-input" [(ngModel)]="editForm.alert_sms" name="alert_sms" id="alertSMS">
            <label class="form-check-label fw-semibold" for="alertSMS">SMS Alerts</label>
          </div>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col-md-6">
          <div class="form-check form-switch">
            <input type="checkbox" class="form-check-input" [(ngModel)]="editForm.save_recording" name="save_recording" id="saveRecording">
            <label class="form-check-label fw-semibold" for="saveRecording">Save Recordings</label>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-check form-switch">
            <input type="checkbox" class="form-check-input" [(ngModel)]="editForm.is_active" name="is_active" id="isActiveSwitch">
            <label class="form-check-label fw-semibold" for="isActiveSwitch">Active Scenario</label>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <div class="form-check form-switch">
          <input type="checkbox" class="form-check-input" [(ngModel)]="editForm.is_manual" name="is_manual" id="isManual">
          <label class="form-check-label fw-semibold" for="isManual">Manual Mode (otherwise automatic)</label>
        </div>
      </div>

      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary btn-lg d-flex align-items-center" [disabled]="!scenarioForm.form.valid">
          <i class="bi" [ngClass]="editing ? 'bi-check-circle' : 'bi-plus-circle'"></i>
          <span class="ms-2">{{ editing ? "Update Scenario" : "Create Scenario" }}</span>
        </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" (click)="showAddForm = false">
          <i class="bi bi-x-circle"></i>
          <span class="ms-2">Cancel</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Scenarios Table -->
  <div class="card shadow-sm border-0">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0 d-flex align-items-center">
        <i class="bi bi-list-check me-2"></i>
        Security Scenarios
      </h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-4">Name</th>
              <th>User</th>
              <th>Priority</th>
              <th>Status</th>
              <th>Preview</th>
              <th class="text-center pe-4">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let scenario of scenarios" class="align-middle">
              <td class="ps-4 fw-semibold">{{ scenario.name }}</td>
              <td>{{ scenario.user_name }}</td>
              <td>
                <span [ngClass]="{
                  'badge bg-danger': scenario.priority === 'critical',
                  'badge bg-warning text-dark': scenario.priority === 'high',
                  'badge bg-info': scenario.priority === 'medium',
                  'badge bg-secondary': scenario.priority === 'low'
                }">
                  {{ scenario.priority | titlecase }}
                </span>
              </td>
              <td>
                <span class="badge" [ngClass]="scenario.is_active ? 'bg-success' : 'bg-secondary'">
                  {{ scenario.is_active ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td class="text-muted small">{{ scenario.preview }}</td>
              <td class="pe-4">
                <div class="d-flex gap-1 justify-content-center">
                  <button class="btn btn-outline-primary btn-sm d-flex align-items-center" (click)="editScenario(scenario)">
                    <i class="bi bi-pencil-fill me-1"></i> Edit
                  </button>
                  <button class="btn btn-outline-danger btn-sm d-flex align-items-center" (click)="deleteScenario(scenario.id)">
                    <i class="bi bi-trash-fill me-1"></i> Delete
                  </button>
                  <a routerLink="ai-dashboard" [queryParams]="{ scenarioId: scenario.id }" 
                     class="btn btn-outline-info btn-sm d-flex align-items-center">
                    <i class="bi bi-robot me-1"></i> AI Analysis
                  </a>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="scenarios.length === 0 && !showAddForm" class="text-center py-5">
    <i class="bi bi-shield-exclamation text-muted" style="font-size: 3rem;"></i>
    <h4 class="text-muted mt-3">No Security Scenarios</h4>
    <p class="text-muted">Create your first security scenario to get started.</p>
    <button class="btn btn-primary btn-lg" (click)="showAddForm = true">
      <i class="bi bi-plus-circle me-2"></i>Create First Scenario
    </button>
  </div>
</div>