<div class="ai-performance-dashboard">
  <!-- En-tÃªte avec sÃ©lecteur dynamique + BACK BUTTON -->
  <div class="dashboard-header mb-2">
    <div class="d-flex justify-content-between align-items-center">
      <h4>ğŸ§  Tableau de Bord IA - ScÃ©narios de SÃ©curitÃ©</h4>
      <div class="d-flex gap-2 align-items-center">
        <div class="form-group mb-0">
          <select
            class="form-select form-select-sm"
            (change)="onScenarioChange($event)"
            [disabled]="isloadingScenarios || isLoading"
          >
            <option value="">SÃ©lectionner un scÃ©nario</option>
            <option
              *ngFor="let scenario of scenarios"
              [value]="scenario.id"
              [selected]="scenario.id === selectedScenario?.id"
            >
              {{ scenario.name }} ({{ scenario.user_name }}) - {{ scenario.is_active ? 'Actif' : 'Inactif' }}
            </option>
          </select>
        </div>

        <button
          class="btn btn-sm btn-outline-primary"
          (click)="loadPerformanceAnalysis()"
          [disabled]="isLoading || !selectedScenario"
        >
          ğŸ”„ Actualiser
        </button>
       <button class="btn btn-secondary btn-sm ms-2" (click)="goBack()">â† Retour</button>

      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isloadingScenarios" class="text-center my-2">
    <div class="spinner-border text-primary"></div>
    <p class="mb-0">Chargement des scÃ©narios...</p>
  </div>

  <!-- Aucun scÃ©nario -->
  <div
    *ngIf="!isloadingScenarios && scenarios.length === 0"
    class="alert alert-warning text-center mb-2"
  >
    Aucun scÃ©nario disponible.
  </div>

  <!-- Aucun scÃ©nario sÃ©lectionnÃ© -->
  <div
    *ngIf="!isloadingScenarios && scenarios.length > 0 && !selectedScenario"
    class="alert alert-info text-center mb-2"
  >
    SÃ©lectionnez un scÃ©nario pour afficher son analyse IA.
  </div>

  <!-- Affichage des donnÃ©es + CHART -->
  <div *ngIf="performanceData && selectedScenario" class="card p-2 shadow-sm">
    <h5 class="mb-1">ğŸ“Š Analyse du scÃ©nario : {{ selectedScenario.name }}</h5>
    <hr class="my-1" />

    <p class="mb-1">
      <strong>Performance Score :</strong>
      <span
        class="badge"
        [ngClass]="
          'bg-' + getPerformanceColor(performanceData.performance_score)
        "
      >
        {{ performanceData.performance_score }}%
      </span>
    </p>

    <p class="mb-2">
      <strong>Niveau de Risque :</strong>
      <span
        class="badge"
        [ngClass]="'bg-' + getRiskLevelColor(performanceData.risk_level)"
      >
        {{ performanceData.risk_level }}
      </span>
    </p>

    <div class="mt-1">
      <h6 class="mb-1">ğŸ“ˆ DÃ©tails :</h6>
      <ul class="mb-1">
        <li class="mb-0">
          <strong>Couverture Ã‰vÃ©nements :</strong>
          {{ performanceData.performance_data?.event_coverage?.score }}%
        </li>
        <li class="mb-0">
          <strong>Configuration Conditions :</strong>
          {{ performanceData.performance_data?.condition_setup?.score }}%
        </li>
        <li class="mb-0">
          <strong>PrÃªtetÃ© Actions :</strong>
          {{ performanceData.performance_data?.action_readiness?.score }}%
        </li>
      </ul>
    </div>

    <!-- Bar Chart -->
    <div class="mt-2">
      <h6 class="mb-1">ğŸ“Š Visualisation des Scores</h6>
      <div style="height: 250px;">
        <canvas baseChart
          [data]="barChartData"
          [options]="barChartOptions"
          [type]="barChartType">
        </canvas>
      </div>
    </div>

    <div class="mt-2 recos-section">
      <h6 class="mb-1">ğŸ’¡ Recommandations :</h6>
      <ul>
        <li *ngFor="let rec of performanceData.recommendations">
          {{ rec.title }} â€” {{ rec.description }}
        </li>
      </ul>
    </div>

    <div class="mt-1 insights-section">
      <h6 class="mb-1">ğŸ¤– Insights IA :</h6>
      <ul>
        <li *ngFor="let insight of performanceData.ai_insights">
          {{ insight }}
        </li>
      </ul>
    </div>
  </div>

  <!-- Loading IA -->
  <div *ngIf="isLoading" class="text-center my-2">
    <div class="spinner-border text-primary"></div>
    <p class="mb-0">Analyse IA en cours...</p>
  </div>
</div>